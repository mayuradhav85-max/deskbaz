<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DESKBAZ • India's #1 Helpdesk</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body{font-family:Arial,sans-serif;background:#f0f5ff;margin:0;padding:20px;color:#333;}
    .main{max-width:1400px;margin:auto;background:white;border-radius:20px;padding:40px;box-shadow:0 0 20px 60px rgba(0,0,0,0.1);}
    .header{background:linear-gradient(135deg,#0066ff,#00c2ff);color:white;text-align:center;padding:50px;border-radius:20px 20px 0 0;margin:-40px -40px 40px;}
    .logo{font-size:80px;font-weight:900;background:linear-gradient(135deg,#fff,#ccffff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
    h2{color:#0066ff;text-align:center;}
    button{padding:15px 30px;margin:10px;background:#0066ff;color:white;border:none;border-radius:12px;font-size:18px;cursor:pointer;}
    button:hover{background:#0044cc;}
    table{width:100%;border-collapse:collapse;margin-top:30px;}
    th{background:#0066ff;color:white;padding:15px;}
    td{padding:15px;background:#f8fbff;border-bottom:1px solid #eee;}
    .user{font-size:22px;font-weight:bold;color:#0066ff;text-align:center;margin:30px;}
  </style>
</head>
<body>
<div class="main">
  <div class="header">
    <h1 class="logo">DESKBAZ</h1>
    <p style="font-size:28px;margin:15px;">Your Personal Helpdesk – Live Now</p>
  </div>

  <div class="user" id="user">Loading...</div>

  <div style="text-align:center;">
    <button onclick="login()">Login with Email</button>
    <button onclick="load()">Refresh Tickets</button>
  </div>

  <h2>Your Tickets</h2>
  <table>
    <thead>
      <tr>
        <th>Ticket ID</th>
        <th>Date</th>
        <th>From</th>
        <th>Subject</th>
        <th>Status</th>
        <th>Agent</th>
      </tr>
    </thead>
    <tbody id="tickets"></tbody>
  </table>
</div>

<script>
// YOUR KEYS FROM YOUR SUPABASE SCREENSHOT — ALREADY FILLED
const SUPABASE_URL = "https://sb.publishable_LEIROAliVJHuf8c13fcdw_69Fln_bo.supabase.co";
const SUPABASE_ANON_KEY = "sb.publishable_LEIROAliVJHuf8c13fcdw_69Fln_bo";

const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

async function login() {
  const email = prompt("Enter your email for magic link:");
  if (email) {
    await supabase.auth.signInWithOtp({ email });
    alert("Check your email – magic link sent!");
  }
}

supabase.auth.onAuthStateChange((_, session) => {
  const email = session?.user?.email || "Not logged in";
  document.getElementById("user").innerText = `Agent: ${email}`;
  if (session) load();
});

async function load() {
  const { data } = await supabase.from('tickets').select('*').order('created_at', {ascending: false});
  const tbody = document.getElementById('tickets');
  tbody.innerHTML = data.length === 0 
    ? `<tr><td colspan="6" style="text-align:center;padding:100px;font-size:24px;color:#0066ff;">No tickets yet – you're all clear!</td></tr>`
    : data.map(t => `
      <tr>
        <td><strong>${t.ticket_id></strong></td>
        <td>${new Date(t.created_at).toLocaleString('en-IN')}</td>
        <td>${t.from_email}</td>
        <td>${t.subject || '(no subject)'}</td>
        <td style="color:${t.status==='Closed'?'#137333':'#d32f2f'}"><strong>${t.status || 'Open'}</strong></td>
        <td>${t.assigned_to || 'Unassigned'}</td>
      </tr>
    `).join('');
}

load();
setInterval(load, 30000);
</script>
</body>
</html>
